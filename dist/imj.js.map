{"version":3,"sources":["../src/imj.js"],"names":["CloneMode","None","Unknown","Object","Array","defaultSelector","x","arrayEqual","arr1","arr2","length","isArray","every","item","index","Modifier","value","args","original","assign","result","__result","method","clone","modifiedArray","mutate","slice","some","__orderBy","selector","sort","a","b","aValue","bValue","__reverse","__arrayProxy","__sort","comparer","__filter","predicate","__slice","from","to","__shift","prev","next","shift","__remove","keys","map","tryExtractPropNameFromAccessor","Set","Map","key","has","sortedKeys","splice","pop","forEach","__pop","__keep","reduce","set","get","obj","__unshift","values","concat","__splice","count","newItems","__unset","props","prop","__mutate","cloneMode","checker","modifier","Date","getTime","__push","__assign","newProps","finalProps","__map","mapper","clonedValue","__swap","prop1","prop2","temp","__current","__toggle","__add","d","getFullYear","years","getMonth","months","getDate","days","getHours","hours","getMinutes","minutes","getSeconds","seconds","getMilliseconds","milliseconds","__replace","findWhat","replaceWith","replace","fallback","propName","processArgs","state","nextState","subSpecs","path","join","split","arg","$$","processWhen","targetPath","valueToCompare","targetSpecs","targetValue","getValue","processSpecs","processArrayItemSpecs","many","defaultItemSpecs","undefined","found","hasChange","nextArray","itemSpecs","newItem","processIf","condition","$then","$else","isTruth","processVar","entries","varName","processSelf","cloneObject","processNormalProp","returnSpecs","returnValue","Error","imj","isNestedProps","prevPropValue","nextPropValue","stack","container","i","push","last","specs","isSpecialProp","nextSpecs","test","target","inputs","$","$input"],"mappings":"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","sourcesContent":["const CloneMode = {\n  None: 0,\n  Unknown: 1,\n  Object: 2,\n  Array: 3\n};\nconst defaultSelector = x => x;\n\nfunction arrayEqual(arr1, arr2) {\n  if (arr1 === arr2) return true;\n  if (!arr1 || !arr2 || arr1.length !== arr2.length) return false;\n  if (!Array.isArray(arr1) || Array.isArray(arr2)) return false;\n  return arr1.every((item, index) => arr2[index] === item);\n}\n\nclass Modifier {\n  constructor(value, args) {\n    this.original = value;\n    this.value = value;\n    Object.assign(this, args, {\n      result: () => this.__result\n    });\n  }\n\n  get orderBy() {\n    return (\n      this.__orderBy ||\n      (this.__orderBy = selector => {\n        return this.sort((a, b) => {\n          const aValue = selector(a);\n          const bValue = selector(b);\n          if (aValue > bValue) {\n            return 1;\n          }\n          return aValue === bValue ? 0 : -1;\n        });\n      })\n    );\n  }\n\n  get reverse() {\n    return (\n      this.__reverse ||\n      (this.__reverse = () => {\n        return this.__arrayProxy(\"reverse\", true);\n      })\n    );\n  }\n\n  get sort() {\n    return (\n      this.__sort ||\n      (this.__sort = comparer => {\n        return this.__arrayProxy(\"sort\", true, [comparer]);\n      })\n    );\n  }\n\n  get filter() {\n    return (\n      this.__filter ||\n      (this.__filter = predicate => {\n        return this.__arrayProxy(\"filter\", false, [predicate]);\n      })\n    );\n  }\n\n  get slice() {\n    return (\n      this.__slice ||\n      (this.__slice = (from, to) => {\n        return this.__arrayProxy(\"slice\", false, [from, to]);\n      })\n    );\n  }\n\n  get shift() {\n    return (\n      this.__shift ||\n      (this.__shift = () => {\n        return this.mutate(\n          CloneMode.Array,\n          prev => prev && prev.length,\n          next => next.shift()\n        );\n      })\n    );\n  }\n\n  get remove() {\n    return (\n      this.__remove ||\n      (this.__remove = (...keys) => {\n        keys = keys.map(tryExtractPropNameFromAccessor);\n\n        return this.mutate(\n          CloneMode.Unknown,\n          prev =>\n            prev &&\n            (prev instanceof Set || prev instanceof Map\n              ? keys.some(key => prev.has(key))\n              : keys.some(key => key in prev)),\n          next => {\n            if (Array.isArray(next)) {\n              const sortedKeys = keys.sort();\n              while (sortedKeys.length) {\n                next.splice(sortedKeys.pop(), 1);\n              }\n            } else if (next instanceof Map || next instanceof Set) {\n              keys.forEach(key => next.delete(key));\n            } else {\n              keys.forEach(key => delete next[key]);\n            }\n          }\n        );\n      })\n    );\n  }\n\n  get pop() {\n    return (\n      this.__pop ||\n      (this.__pop = () => {\n        return this.mutate(\n          CloneMode.Array,\n          prev => prev && prev.length,\n          next => next.pop()\n        );\n      })\n    );\n  }\n\n  get keep() {\n    return (\n      this.__keep ||\n      (this.__keep = (...keys) => {\n        keys = keys.map(tryExtractPropNameFromAccessor);\n        return this.mutate(\n          CloneMode.Unknown,\n          () => true,\n          prev => prev,\n          next => {\n            if (next instanceof Map) {\n              return keys.reduce((map, key) => {\n                map.set(key, next.get(key));\n                return map;\n              }, new Map());\n            }\n\n            if (Array.isArray(next)) {\n              return keys.map(key => next[key]);\n            }\n\n            if (typeof next === \"undefined\" || next === null) {\n              return {};\n            }\n\n            return keys.reduce((obj, key) => {\n              obj[key] = next[key];\n              return obj;\n            }, {});\n          }\n        );\n      })\n    );\n  }\n\n  get unshift() {\n    return (\n      this.__unshift ||\n      (this.__unshift = (...values) => {\n        return this.mutate(\n          CloneMode.None,\n          () => !!values.length,\n          next => values.concat(next || [])\n        );\n      })\n    );\n  }\n\n  get splice() {\n    return (\n      this.__splice ||\n      (this.__splice = (index, count, ...newItems) => {\n        return this.mutate(\n          CloneMode.Array,\n          prev => prev && ((count && prev.length > index) || newItems.length),\n          next => next.splice(index, count, ...newItems)\n        );\n      })\n    );\n  }\n\n  get unset() {\n    return (\n      this.__unset ||\n      (this.__unset = (...props) => {\n        props = props.map(tryExtractPropNameFromAccessor);\n        return this.mutate(\n          CloneMode.Unknown,\n          prev => prev && props.some(prop => prop in prev),\n          next => props.forEach(prop => delete next[prop])\n        );\n      })\n    );\n  }\n\n  get mutate() {\n    return (\n      this.__mutate ||\n      (this.__mutate = (\n        cloneMode,\n        checker,\n        modifier,\n        selector = defaultSelector\n      ) => {\n        let value = this.value;\n\n        // do nothing\n        if (!checker(value)) {\n          return this;\n        }\n\n        if (cloneMode && value === this.original) {\n          if (typeof value === \"undefined\" || value === null) {\n            value = cloneMode === CloneMode.Array ? [] : {};\n          } else if (Array.isArray(value)) {\n            value = selector(value).slice(0);\n          } else if (value instanceof Date) {\n            value = new Date(value.getTime());\n          } else if (value instanceof Set) {\n            value = new Set(selector(value));\n          } else if (value instanceof Map) {\n            value = new Map(selector(value));\n          } else if (typeof value === \"object\") {\n            value = Object.assign({}, selector(value));\n          }\n        }\n\n        const next = modifier(value);\n        if (cloneMode) {\n          this.value = value;\n          this.__result = next;\n        } else {\n          this.value = next;\n        }\n\n        return this;\n      })\n    );\n  }\n\n  get push() {\n    return (\n      this.__push ||\n      (this.__push = (...values) => {\n        return this.mutate(\n          CloneMode.None,\n          () => values.length,\n          next => [].concat(next || []).concat(values)\n        );\n      })\n    );\n  }\n\n  get assign() {\n    return (\n      this.__assign ||\n      (this.__assign = (...newProps) => {\n        const finalProps = Object.assign({}, ...newProps);\n        return this.mutate(\n          CloneMode.Object,\n          prev =>\n            !prev ||\n            Object.keys(finalProps).some(key => finalProps[key] !== prev[key]),\n          next => Object.assign(next, finalProps)\n        );\n      })\n    );\n  }\n\n  get map() {\n    return (\n      this.__map ||\n      (this.__map = mapper => {\n        let clonedValue;\n        return this.mutate(\n          CloneMode.None,\n          prev => {\n            if (!prev) return true;\n            clonedValue = prev.map(mapper);\n            return !arrayEqual(clonedValue, prev);\n          },\n          () => clonedValue\n        );\n      })\n    );\n  }\n\n  get swap() {\n    return (\n      this.__swap ||\n      (this.__swap = (prop1, prop2) =>\n        this.mutate(\n          CloneMode.Unknown,\n          prev => !prev || prev[prop1] !== prev[prop2],\n          next => {\n            const temp = next[prop1];\n            next[prop1] = next[prop2];\n            next[prop2] = temp;\n          }\n        ))\n    );\n  }\n\n  get current() {\n    return this.__current || (this.__current = () => this.value);\n  }\n\n  get toggle() {\n    return (\n      this.__toggle ||\n      (this.__toggle = () => {\n        this.value = !this.value;\n        return this;\n      })\n    );\n  }\n\n  get add() {\n    return (\n      this.__add ||\n      (this.__add = (value = 1) => {\n        if (\n          this.value instanceof Date ||\n          (typeof this.value === \"string\" && typeof value !== \"string\")\n        ) {\n          const d = new Date(this.value);\n          this.value = new Date(\n            d.getFullYear() + (value.years || 0),\n            d.getMonth() + (value.months || 0),\n            d.getDate() + (value.days || 0),\n            d.getHours() + (value.hours || 0),\n            d.getMinutes() + (value.minutes || 0),\n            d.getSeconds() + (value.seconds || 0),\n            d.getMilliseconds() + (value.milliseconds || 0)\n          );\n        } else {\n          this.value += value;\n        }\n        return this;\n      })\n    );\n  }\n\n  get replace() {\n    return (\n      this.__replace ||\n      (this.__replace = (findWhat, replaceWith) =>\n        this.mutate(\n          CloneMode.None,\n          () => true,\n          next => next.replace(findWhat, replaceWith)\n        ))\n    );\n  }\n\n  __arrayProxy(method, clone, args = []) {\n    let modifiedArray;\n    return this.mutate(\n      CloneMode.None,\n      original => {\n        if (typeof original === \"undefined\" || original === null) {\n          original = [];\n        }\n        modifiedArray = (clone ? original.slice(0) : original)[method](...args);\n        return (\n          modifiedArray.length !== original.length ||\n          modifiedArray.some((item, index) => item !== original[index])\n        );\n      },\n      () => modifiedArray\n    );\n  }\n}\n\nfunction tryExtractPropNameFromAccessor(prop, fallback) {\n  if (typeof prop === \"function\" && prop.propName) {\n    return prop.propName;\n  }\n  return typeof fallback === \"function\" ? fallback(prop) : prop;\n}\n\nfunction processArgs(state, nextState, args, prop, subSpecs, path) {\n  (Array.isArray(subSpecs) ? subSpecs.join(\" \") : subSpecs)\n    .split(/\\s+/)\n    .forEach((arg, index) => (args[arg] = args.$$[index]));\n  return nextState;\n}\n\nfunction processWhen(state, nextState, args, prop, subSpecs, path) {\n  const [targetPath, valueToCompare, targetSpecs] = subSpecs;\n  const targetValue = getValue(targetPath, { value: nextState, ...args });\n  if (targetValue === valueToCompare) {\n    nextState = processSpecs(nextState, targetSpecs, args, path + \".\");\n  }\n  return nextState;\n}\n\nfunction processArrayItemSpecs(state, nextState, args, prop, subSpecs, path) {\n  if (Array.isArray(nextState)) {\n    const many = prop === \"$many\";\n    const defaultItemSpecs =\n      typeof subSpecs === \"function\" ? undefined : subSpecs;\n    let found = false;\n    let hasChange = false;\n    const nextArray = nextState.map((item, index) => {\n      if (found && !many) {\n        return item;\n      }\n      const itemSpecs =\n        defaultItemSpecs || subSpecs({value: item, index, ...args});\n      if (!itemSpecs) return item;\n      found = true;\n      const newItem = processSpecs(item, itemSpecs, args, path + \".\" + index);\n      if (newItem !== item) {\n        hasChange = true;\n      }\n      return newItem;\n    });\n    if (hasChange) {\n      nextState = nextArray;\n    }\n  }\n  return nextState;\n}\n\nfunction processIf(state, nextState, args, prop, subSpecs, path) {\n  const [condition, $then, $else] = subSpecs;\n  const isTruth =\n    typeof condition === \"function\"\n      ? condition({ value: nextState, ...args })\n      : condition;\n\n  if (isTruth) {\n    if ($then) {\n      nextState = processSpecs(nextState, $then, args, path + \".\");\n    }\n  } else if ($else) {\n    nextState = processSpecs(nextState, $else, args, path + \".\");\n  }\n  return nextState;\n}\n\nfunction processVar(state, nextState, args, prop, subSpecs, path) {\n  if (typeof subSpecs === \"function\") {\n    Object.assign(args, subSpecs({ value: nextState, ...args }));\n  } else {\n    Object.entries(subSpecs).forEach(([varName, path]) => {\n      path = tryExtractPropNameFromAccessor(path);\n      args[varName] =\n        typeof path === \"function\"\n          ? path({ value: nextState, ...args })\n          : getValue(path, nextState);\n    });\n  }\n  return nextState;\n}\n\nfunction processSelf(state, nextState, args, prop, subSpecs, path) {\n  let modifier = new Modifier(nextState, args);\n  nextState = subSpecs(modifier);\n  if (modifier && modifier.original !== modifier.value) {\n    nextState = modifier.value;\n  }\n\n  return nextState;\n}\n\nfunction cloneObject(state) {\n  return Array.isArray(state)\n    ? state.slice(0)\n    : state instanceof Map\n      ? new Map(state)\n      : Object.assign({}, state);\n}\n\nfunction processNormalProp(\n  state,\n  nextState,\n  args,\n  prop,\n  subSpecs,\n  returnSpecs,\n  returnValue,\n  path\n) {\n  if (\n    typeof subSpecs === \"object\" ||\n    typeof subSpecs === \"string\" ||\n    Array.isArray(subSpecs) ||\n    typeof subSpecs === \"function\"\n  ) {\n    // valid specs type\n  } else {\n    throw new Error(\n      `Invalid specs: ${path +\n      prop}. Sub specs should be object, array or function`\n    );\n  }\n\n  if (returnSpecs && typeof subSpecs !== \"function\") {\n    returnValue[prop] = imj(subSpecs);\n    return nextState;\n  }\n\n  // console.log(returnSpecs, prop, subSpecs);\n\n  const props = Array.isArray(prop)\n    ? prop.map(tryExtractPropNameFromAccessor)\n    : tryExtractPropNameFromAccessor(prop).split(\".\");\n  const isNestedProps = props.length > 1;\n\n  prop = props[0];\n  let modifier;\n\n  const prevPropValue = isNestedProps\n    ? getValue(props, nextState)\n    : nextState[prop];\n  let nextPropValue;\n\n  if (typeof subSpecs === \"function\") {\n    modifier = new Modifier(prevPropValue, args);\n    nextPropValue = subSpecs(modifier);\n  } else if (typeof subSpecs === \"string\") {\n    nextPropValue = getValue(subSpecs, args);\n  } else {\n    nextPropValue = processSpecs(\n      prevPropValue,\n      subSpecs,\n      args,\n      path + prop + \".\"\n    );\n  }\n\n  // there is something changed\n  if (modifier && modifier.original !== modifier.value) {\n    nextPropValue = modifier.value;\n  }\n\n  if (returnSpecs) {\n    returnValue[prop] = nextPropValue;\n    return nextState;\n  }\n\n  if (\n    nextPropValue !== prevPropValue &&\n    !arrayEqual(nextPropValue, prevPropValue)\n  ) {\n    if (nextState === state) {\n      nextState = cloneObject(state);\n    }\n    if (isNestedProps) {\n      const stack = [];\n      let container = nextState;\n      for (let i = 0; i < props.length; i++) {\n        let prev = { container, prop: props[i] };\n        stack.push(prev);\n        prev.container[prev.prop] = container = cloneObject(\n          container[prev.prop]\n        );\n      }\n      const last = stack[stack.length - 1];\n      last.container[last.prop] = nextPropValue;\n    } else {\n      nextState[prop] = nextPropValue;\n    }\n  }\n  return nextState;\n}\n\nfunction processSpecs(state = {}, specs = {}, args = {}, path = \"\") {\n  let nextState = state;\n  let returnSpecs = false;\n  let returnValue = {};\n  const entries = Array.isArray(specs) ? specs.slice(0) : Object.entries(specs);\n  const length = entries.length;\n  for (let i = 0; i < length; i++) {\n    let [prop, subSpecs] = entries[i];\n\n    if (prop === \"$return\") {\n      returnSpecs = true;\n      continue;\n    }\n\n    if (!subSpecs) {\n      continue;\n    }\n    let isSpecialProp = true;\n    if (typeof prop === \"string\" && prop[0] === \"$\") {\n      if (prop === \"$args\") {\n        nextState = processArgs(state, nextState, args, prop, subSpecs, path);\n      } else if (prop === \"$self\") {\n        nextState = processSelf(state, nextState, args, prop, subSpecs, path);\n      } else if (prop === \"$one\" || prop === \"$many\") {\n        nextState = processArrayItemSpecs(\n          state,\n          nextState,\n          args,\n          prop,\n          subSpecs,\n          path\n        );\n      } else if (prop === \"$extend\") {\n        const nextSpecs = subSpecs({ value: nextState, ...args });\n        if (nextSpecs) {\n          nextState = processSpecs(\n            state,\n            nextState,\n            nextSpecs,\n            args,\n            path + prop + \".\"\n          );\n        }\n      } else if (prop[1] === \"w\" && /^\\$when/.test(prop)) {\n        nextState = processWhen(state, nextState, args, prop, subSpecs, path);\n      } else if (prop[1] === \"i\" && /^\\$if/.test(prop)) {\n        nextState = processIf(state, nextState, args, prop, subSpecs, path);\n      } else if (prop[1] === \"v\" && /^\\$var/.test(prop)) {\n        nextState = processVar(state, nextState, args, prop, subSpecs, path);\n      } else {\n        isSpecialProp = false;\n      }\n    } else {\n      isSpecialProp = false;\n    }\n\n    if (!isSpecialProp) {\n      nextState = processNormalProp(\n        state,\n        nextState,\n        args,\n        prop,\n        subSpecs,\n        returnSpecs,\n        returnValue,\n        path\n      );\n    }\n  }\n\n  return returnSpecs ? returnValue : nextState;\n}\n\nfunction getValue(path, target) {\n  return (Array.isArray(path) ? path : path.split(\".\")).reduce(\n    (target, prop) => {\n      prop = tryExtractPropNameFromAccessor(prop);\n      return typeof target === \"undefined\" || target === null\n        ? target\n        : target[prop];\n    },\n    target\n  );\n}\n\nexport default function imj(...inputs) {\n  if (inputs.length > 1) {\n    return imj(inputs[1])(inputs[0], ...inputs.slice(2));\n  }\n  const [specs = {}] = inputs;\n  return (state, ...args) => {\n    if (state instanceof Modifier) {\n      state = state.value;\n    }\n    return processSpecs(state, specs, {\n      $$: args,\n      $: state,\n      $input: args[0],\n      // automap input args to props: $1, $2, $3, ...\n      ...args.reduce((result, arg, index) => {\n        result[`$${index + 1}`] = arg;\n        return result;\n      }, {})\n    });\n  };\n}\n"],"file":"imj.js"}